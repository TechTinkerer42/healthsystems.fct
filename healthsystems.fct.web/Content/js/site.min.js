function checkTabErrors(){var t=!0,e=!1,o="div.tab-pane";return $(o).each(function(o,n){var a="p.help-block.with-errors",r=$(n).find(a),i=$(".nav.nav-tabs li a")[o];$(i).html($(i).attr("data-description")),$.each(r,function(a,r){if(""!==$(r).html()&&(t=!1,e=!0),e){console.log(n.id);var i=$(".nav.nav-tabs li a")[o];$(i).html($(i).attr("data-description")+TabErrorHtml),e=!1}})}),t}function handleError(t){toastr.error(t.data+t.status+t.header+t.config),console.log(t.data+t.status+t.header+t.config)}var TabErrorHtml='&nbsp;<i class="fa fa-warning red" data-placement="top" title="This tab is missing some mandatory fields"></i>';$(function(){$('[data-toggle="tooltip"]').tooltip(),$.fn.validator.Constructor.INPUT_SELECTOR=':input:not([type="submit"], button):enabled',$("#myForm input[required], #myForm select[required]").on("change",function(){checkTabErrors()}),$("form").on("keydown","input[data-type=number]",function(t){-1!==$.inArray(t.keyCode,[46,8,9,27,13,110,190])||65===t.keyCode&&t.ctrlKey===!0||67===t.keyCode&&t.ctrlKey===!0||88===t.keyCode&&t.ctrlKey===!0||t.keyCode>=35&&t.keyCode<=39||(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()}),$(":input").inputmask(),$(".input-daterange").datepicker({format:"dd/mm/yyyy"}),$("body").on("click","a.tab-btn",function(t){t.preventDefault()})});var app=angular.module("fct",["ui.router","smart-table","angular-ladda","ngResource","agGrid"],function(t){t.interceptors.push("AuthInterceptorFactory")});app.constant("API_URL",SITE_URL),app.config(function(t,e){var o=SITE_SUFFIX;e.otherwise("/login"),t.state("login",{url:"/login",templateUrl:o+"/Content/views/login.html",controller:"LoginController"}).state("logout",{url:"/logout",templateUrl:o+"/Content/views/logout.html",controller:"LogoutController"}).state("dashboard",{url:"/dashboard",templateUrl:o+"/Content/views/dashboard.html",controller:"DashboardController"}).state("registration",{url:"/registration",templateUrl:o+"/Content/views/registration.html",controller:"RegistrationController"}).state("registration-edit",{url:"/registration/:id",templateUrl:o+"/Content/views/registration.html",controller:"RegistrationController"}).state("search",{url:"/search",templateUrl:o+"/Content/views/search.html",controller:"SearchController"}).state("payments",{url:"/payments",templateUrl:o+"/Content/views/payments.html"}).state("makepayment",{url:"/payments/makepayment",templateUrl:o+"/Content/views/makepayment.html",controller:"OutstandingController"}).state("transact",{url:"/payments/transact/:id",templateUrl:o+"/Content/views/transact.html",controller:"TransactController"}).state("enquiry",{url:"/payments/enquiry",templateUrl:o+"/Content/views/enquiry.html",controller:"EnquiryController"}).state("outstanding",{url:"/payments/outstanding",templateUrl:o+"/Content/views/outstanding.html",controller:"OutstandingController"}).state("location-map",{url:"/location-map",templateUrl:o+"/Content/views/location-map.html",controller:"LocationMapController"}).state("masterfiles",{url:"/masterfiles",templateUrl:o+"/Content/views/masterfiles.html",controller:"MasterfileController"}).state("category",{url:"/masterfiles/category",templateUrl:o+"/Content/views/masterfiles/category/index.html",controller:"CategoryController"}).state("category-create",{url:"/masterfiles/category/create",templateUrl:o+"/Content/views/masterfiles/category/manage.html",controller:"CategoryManageController"}).state("category-edit",{url:"/masterfiles/category/:id",templateUrl:o+"/Content/views/masterfiles/category/manage.html",controller:"CategoryManageController"}).state("costing",{url:"/masterfile/costing",templateUrl:o+"/Content/views/masterfiles/costing/index.html",controller:"CostingController"}).state("costing-create",{url:"/masterfile/costing/create",templateUrl:o+"/Content/views/masterfiles/costing/manage.html",controller:"CostingManageController"}).state("costing-edit",{url:"/masterfile/costing/:id",templateUrl:o+"/Content/views/masterfiles/costing/manage.html",controller:"CostingManageController"}).state("location",{url:"/masterfile/location",templateUrl:o+"/Content/views/masterfiles/location/index1.html",controller:"LocationController"}).state("location-create",{url:"/masterfile/location/create",templateUrl:o+"/Content/views/masterfiles/location/manage.html",controller:"LocationManageController"}).state("location-edit",{url:"/masterfile/location/:id",templateUrl:o+"/Content/views/masterfiles/location/manage.html",controller:"LocationManageController"}).state("permission",{url:"/masterfile/permission",templateUrl:o+"/Content/views/masterfiles/permission/index.html",controller:"PermissionController"}).state("permission-create",{url:"/masterfile/permission/create",templateUrl:o+"/Content/views/masterfiles/permission/manage.html",controller:"PermissionManageController"}).state("permission-edit",{url:"/masterfile/permission/:id",templateUrl:o+"/Content/views/masterfiles/permission/manage.html",controller:"PermissionManageController"}).state("role",{url:"/masterfile/role",templateUrl:o+"/Content/views/masterfiles/role/index.html",controller:"RoleController"}).state("role-create",{url:"/masterfile/role/create",templateUrl:o+"/Content/views/masterfiles/role/manage.html",controller:"RoleManageController"}).state("role-edit",{url:"/masterfile/role/:id",templateUrl:o+"/Content/views/masterfiles/role/manage.html",controller:"RoleManageController"}).state("service",{url:"/masterfile/service",templateUrl:o+"/Content/views/masterfiles/service/index.html",controller:"ServiceController"}).state("service-create",{url:"/masterfile/service/create",templateUrl:o+"/Content/views/masterfiles/service/manage.html",controller:"ServiceManageController"}).state("service-edit",{url:"/masterfile/service/:id",templateUrl:o+"/Content/views/masterfiles/service/manage.html",controller:"ServiceManageController"}).state("staffing",{url:"/masterfile/staffing",templateUrl:o+"/Content/views/masterfiles/staffing/index.html",controller:"StaffingController"}).state("staffing-create",{url:"/masterfile/staffing/create",templateUrl:o+"/Content/views/masterfiles/staffing/manage.html",controller:"StaffingManageController"}).state("staffing-edit",{url:"/masterfile/staffing/:id",templateUrl:o+"/Content/views/masterfiles/staffing/manage.html",controller:"StaffingManageController"}).state("user",{url:"/masterfile/user",templateUrl:o+"/Content/views/masterfiles/user/index.html",controller:"UserController"}).state("user-create",{url:"/masterfile/user/create",templateUrl:o+"/Content/views/masterfiles/user/manage.html",controller:"UserManageController"}).state("user-edit",{url:"/masterfile/user/:id",templateUrl:o+"/Content/views/masterfiles/user/manage.html",controller:"UserManageController"})}),app.filter("moment",function(){return function(t,e){var o=Array.prototype.slice.call(arguments,2),n=moment(t);return n[e].apply(n,o)}}),app.filter("iif",function(){return function(t,e,o){return t?e:o}}),app.filter("total",function(){return function(t,e){var o=t instanceof Array?t.length:0;if("undefined"==typeof e||0===o)return o;if(isNaN(t[0][e]))throw"filter total can count only numeric values";for(var n=0;o--;)n+=t[o][e];return n}}),app.factory("LocalStorageFactory",function(t){"use strict";function e(t){return n.getItem(t)}function o(t,e){t&&e?n.setItem(t,e):n.removeItem(t)}var n=t.localStorage;return{getKey:e,setKey:o}}),app.factory("AuthTokenFactory",function(t){"use strict";function e(){return n.getItem(a)}function o(t){t?n.setItem(a,t):n.removeItem(a)}var n=t.localStorage,a="auth-token";return{getToken:e,setToken:o}}),app.factory("AuthInterceptorFactory",function(t){"use strict";function e(e){var o=t.getToken();return o&&(e.headers=e.headers||{},-1===e.url.indexOf("maps.google.com")&&(e.headers.Authorization="Bearer "+o)),e}return{request:e}}),app.factory("LoginFactory",function(t,e,o,n,a){"use strict";function r(a,r){return t.post(e+"/Api/Login",{username:a,password:r}).then(function(t){return o.setToken(t.data.Token),n.setKey("lockout-reason"),t})}function i(){o.setToken()}return{login:r,logout:i}}),app.factory("DashboardFactory",function(t,e){"use strict";return{}}),app.factory("RegistrationFactory",function(t,e){"use strict";function o(o){return t.get(e+"/Api/Registration/"+o)}function n(o,n){var a=n?"?r=1":"";return t.post(e+"/Api/Registration"+a,o)}return{get:o,post:n}}),app.factory("TransactFactory",function(t,e){"use strict";function o(o,n,a,r){return t.post(e+"/Payment/Transact",{renewalId:o,paymentMethodId:n,amountPaid:a,receivedFrom:r})}return{payment:o}}),app.factory("ApiFactory",function(t,e){"use strict";function o(o,n){var a=null!=n?n:"";return t.get(e+"/Api/"+o+"/"+a)}function n(o,n){return t.post(e+"/Api/"+o,n)}return{get:o,post:n}}),app.factory("UserFactory",function(t,e){"use strict";function o(o){var n=null!=o?o:"";return t.get(e+"/Api/"+a+"/"+n)}function n(o){return t.post(e+"/Api/"+a,o)}var a="User";return{get:o,post:n}}),app.factory("CategoryFactory",function(t,e){"use strict";function o(o){var n=null!=o?o:"";return t.get(e+"/Api/"+a+"/"+n)}function n(o){return t.post(e+"/Api/"+a,o)}var a="Category";return{get:o,post:n}}),app.factory("LocationFactory",function(t,e){"use strict";function o(o){var n=null!=o?o:"";return t.get(e+"/Api/"+a+"/"+n)}function n(o){return t.post(e+"/Api/"+a,o)}var a="Location";return{get:o,post:n}}),app.factory("LocationMapService",function(t,e,o,n,a){"use strict";function r(){return t.get(e+"/Api/Registration")}return{getExistingLocations:r}}),app.factory("StringFactory",function(){"use strict";function t(t){var e=Array.prototype.slice.call(arguments,1);return t.replace(/\{(\d+)\}/g,function(t,o){return e[o]})}function e(){}return{f:t,post:e}}),app.factory("LocationMapResource",function(t){return t("http://maps.google.com/maps/api/geocode/json")}),app.controller("NavController",function(t,e,o,n,a){t.IsLoggedIn=!1,null==n.getToken()?(a.setKey("lockout-reason","No session"),e.go("login")):t.IsLoggedIn=!0}),app.controller("LogoutController",function(t,e,o,n,a){n.setToken(),e.go("login")}),app.controller("LoginController",function(t,e,o,n,a){function r(){t.IsSigningIn=!0,o.login(t.Username,t.Password).then(function(o){t.IsSigningIn=!1,null!=n.getToken&&(a.setKey("lockout-reason"),e.go("dashboard"))},function(e){t.IsSigningIn=!1,t.LoginError=e.data.Reason})}t.IsSigningIn=!1,$("#myForm").validator().on("submit",function(t){t.isDefaultPrevented()||r()}),null!=a.getKey("lockout-reason")&&(t.LoginError="Your session has expired. Please log in again",a.setKey("lockout-reason")),$(".navAuth").hide(),t.login=r}),app.controller("DashboardController",function(t,e,o,n,a){null==n.getToken()?(a.setKey("lockout-reason","No session"),e.go("login")):$(".navAuth").show()}),app.controller("RegistrationController",function(t,e,o,n,a,r,i,s,l){function c(){$("#myForm").validator("validate");var e=checkTabErrors();console.log(e),e&&t.saveOrUpdateRegistration()}function u(){}function m(){t.IsSaving=!0,t.SaveButtonText="Saving...",t.Registration.RegistrationDate=moment(t.Registration.RegistrationDate,"DD/MM/YYYY").add(1,"days").toDate().toUTCString();var e=""!=t.Registration.AddressLine1?t.Registration.AddressLine1:"",n=""!=t.Registration.AddressLine2?", "+t.Registration.AddressLine2:"",a=l.f("{0}{1}, {2}, Nigeria",e,n,t.Registration.Location.Name);console.log(a),s.get({address:a},{},function(e){try{if(console.log(e),e.results.length>0){console.log("Hooray there is a result for a position");var n=e.results[0].geometry.location.lat,a=e.results[0].geometry.location.lng;console.log("lat: "+n),console.log("lng: "+a),t.Registration.Latitude=n,t.Registration.Longitude=a}console.log("about to save"),console.log("lat: "+t.Registration.Latitude),console.log("lng: "+t.Registration.longitude),o.post(t.Registration,t.Registration.IsRenewal).then(function(e){t.Registration=e.data,t.IsSaving=!1,t.SaveButtonText="Save Registration",t.Registration.RegistrationDate=moment(t.Registration.RegistrationDate,moment.ISO_8601).format("DD/MM/YYYY"),"01/01/0001"===t.Registration.RegistrationDate&&(t.Registration.RegistrationDate=""),$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError)}catch(r){console.log("Error getting position. "+r.message)}})}t.IsSaving=!1,t.SaveButtonText="Save Registration",t.TooltipText="tooltip",t.allowPrint=!1,t.New=!1,t.Registration={},t.Registration.Renewal=!1,t.Id=null!=i.id?i.id:0,t.Registration.AddressLine1="",t.Registration.AddressLine2="",n.get().then(function(e){t.categories=e.data},handleError),a.get().then(function(e){t.stateLocations=e.data},handleError),t.Id>0?(t.allowPrint=!0,t.TooltipText="",t.Action="edit"):t.New=!0,o.get(t.Id).then(function(e){t.Registration=e.data,t.Registration.RegistrationDate=moment(t.Registration.RegistrationDate,moment.ISO_8601).format("DD/MM/YYYY"),"01/01/0001"===t.Registration.RegistrationDate&&(t.Registration.RegistrationDate=""),t.Id>0&&null!=t.Registration.LastRenewalDate&&(t.Registration.LastRenewalDate=moment(t.Registration.LastRenewalDate,moment.ISO_8601).format("DD/MM/YYYY"),"01/01/0001"===t.Registration.LastRenewalDate&&(t.Registration.LastRenewalDate=""))},handleError),t.submitButtonClick=c,t.successOKButtonClick=u,t.saveOrUpdateRegistration=m,t.$watchCollection("Registration.Renewal",function(e,o){null!=e&&(e?(t.Registration.isRenewal=!0,console.log("is renewal: "+t.Registration.isRenewal)):t.successOKButtonClick())})}),app.controller("MasterfileController",function(t,e,o){}),app.controller("SearchController",function(t,e,o){t.Search={EstablishmentName:"",PhermcRegistrationNumber:"",CacNumber:"",Location:"",RegistrationDateFrom:"",RegistrationDateTo:"",LastRenewalDateFrom:"",LastRenewalDateTo:""},t.IsSearching=!1,t.RegistrationSearchResponse={},t.search=function(){t.Search.RegistrationDateFrom=""!=t.Search.RegistrationDateFrom?moment(t.Search.RegistrationDateFrom,"DD/MM/YYYY").format():"",t.Search.RegistrationDateTo=""!=t.Search.RegistrationDateTo?moment(t.Search.RegistrationDateTo,"DD/MM/YYYY").format():"",t.Search.LastRenewalDateFrom=""!=t.Search.LastRenewalDateFrom?moment(t.Search.LastRenewalDateFrom,"DD/MM/YYYY").format():"",t.Search.LastRenewalDateTo=""!=t.Search.LastRenewalDateTo?moment(t.Search.LastRenewalDateTo,"DD/MM/YYYY").format():"",t.IsSearching=!0,e.post(o+"/Search/Establishment",t.Search).success(function(e){t.IsSearching=!1,t.RegistrationSearchResponse=e,t.Search.RegistrationDateFrom=moment(t.Search.RegistrationDateFrom).isValid()?moment(t.Search.RegistrationDateFrom).format("DD/MM/YYYY"):"",t.Search.RegistrationDateTo=moment(t.Search.RegistrationDateTo).isValid()?moment(t.Search.RegistrationDateTo).format("DD/MM/YYYY"):"",t.Search.LastRenewalDateFrom=moment(t.Search.LastRenewalDateFrom).isValid()?moment(t.Search.LastRenewalDateFrom).format("DD/MM/YYYY"):"",t.Search.LastRenewalDateTo=moment(t.Search.LastRenewalDateTo).isValid()?moment(t.Search.LastRenewalDateTo).format("DD/MM/YYYY"):""})}}),app.controller("OutstandingController",function(t,e,o){t.OutstandingSearchResponse={},t.search=function(){e.post(o+"/Search/Outstanding",t.Search).success(function(e){t.OutstandingSearchResponse=e})}}),app.controller("EnquiryController",function(t,e,o){t.PaymentSearchResponse={},t.search=function(){e.post(o+"/Search/Enquiry",t.Search).success(function(e){t.PaymentSearchResponse=e})}}),app.controller("TransactController",function(t,e,o,n,a,r){function i(){return 0==t.Payment.AmountPaid?void(t.AmountPaidZeroMessage="Please enter an amount"):t.Payment.AmountPaid>t.Renewal.Balance?void(t.AmountPaidZeroMessage="Amount cannot be greater than the outstanding amount"):(t.AmountPaidZeroMessage="",t.Saving=!0,void n.payment(t.Renewal.RenewalId,t.Payment.PaymentMethodId,t.Payment.AmountPaid,t.Payment.ReceivedFrom).then(function(e){t.SuccessTransactionId=e.data,t.Saving=!1,$("#modal-transaction-success").modal({backdrop:"static"}),$("#modal-transaction-success").modal("show")},l))}function s(){$("#modal-transaction-success").modal("hide"),$(".modal-backdrop").hide(),r.go("payments")}function l(t){console.log(t.data+t.status+t.header+t.config)}t.AmountPaidZeroMessage="",t.Renewal={AmountDue:0,TotalPaid:0,Balance:0},t.Payment={PaymentMethodId:"",AmountPaid:0,ReceivedFrom:""},t.SuccessTransactionId=0,t.HidePaymentSection=!1,t.Saving=!1,$("#myForm").validator().on("submit",function(t){t.isDefaultPrevented()||i()}),t.payNow=i,t.successOKButtonClick=s,a.id>0&&e.get(o+"/Api/Renewal/"+a.id).success(function(e){t.Renewal=e[0],0==t.Renewal.Balance&&(t.HidePaymentSection=!0)}),t.$watchCollection("Payment.AmountPaid",function(e,o){null!=e&&e&&(t.AmountPaidZeroMessage="")})}),app.controller("LocationMapController",function(t,e,o,n,a){function r(e,o){t.startPoint=new google.maps.LatLng(e,o);var n=new google.maps.Marker({position:t.startPoint,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"});n.setMap(l)}function i(t){var e=new google.maps.LatLngBounds;l.setTilt(45);var o,n;new google.maps.InfoWindow;for(n=0;n<t.length;n++){var a=t[n].address,r=t[n].lat,i=t[n].lng,s=t[n].html,c=new google.maps.LatLng(r,i);e.extend(c),o=new google.maps.Marker({position:c,map:l,title:a}),l.setCenter(o.getPosition());var u=new google.maps.InfoWindow;google.maps.event.addListener(o,"click",function(t,e,o){return function(){o.setContent(e),o.open(l,t)}}(o,s,u)),l.fitBounds(e)}}function s(t,e,o,n){t.route({origin:o,destination:n,travelMode:google.maps.TravelMode.DRIVING},function(t,o){o===google.maps.DirectionsStatus.OK?e.setDirections(t):window.alert("Directions request failed due to "+o)})}t.search="abuja, nigeria",t.markers=[],t.searchCoordinatesResult=[],t.startPoint=null;var l=new google.maps.Map(document.getElementById("googleMap"),{mapTypeId:"roadmap"}),c=new google.maps.DirectionsService,u=new google.maps.DirectionsRenderer;u.setMap(l),u.setPanel(document.getElementById("right-panel")),o.getExistingLocations().then(function(e){_.each(e.data,function(e){var o={address:e.AddressLine1,lat:e.Latitude,lng:e.Longitude,html:n.f("<div><h4>{0}</h4><p>{1}</p></div>",e.EstablishmentName,e.AddressLine1),description:e.EstablishmentName};t.markers.push(o)}),i(t.markers)}),t.searchClick=function(){e.get({address:t.search},{},function(e){t.searchCoordinatesResult=e.results,console.log(e),r(e.results[0].geometry.location.lat,e.results[0].geometry.location.lng)},function(t){console.log(t),alert("Something went wrong! "+t)})},t.resetSearch=function(){a.go("location-map")},t.calculateRoute=function(){a.go("location-map")},t.calculateRoute=function(){if(t.startPoint){var e=new google.maps.LatLng(t.selectedMarker.lat,t.selectedMarker.lng);s(c,u,t.startPoint,e)}}}),app.controller("CategoryController",function(t,e,o){t.dataList={},e.get(o+"/Api/Category").success(function(e){t.dataList=e})}),app.controller("CategoryManageController",function(t,e,o,n,a){function r(){a.post(t.category).then(function(e){t.category=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError)}t.category={},n.id>0?t.action="Edit":t.action="Create It",a.get(n.id).then(function(e){t.category=e.data},handleError),t.save=r}),app.controller("CostingController",function(t,e,o){t.dataList={},e.get(o+"/Api/Costing").success(function(e){t.dataList=e})}),app.controller("CostingManageController",function(t,e,o,n){function a(){n.post(t.costing).then(function(e){t.costing=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError)}t.category={},t.catIds=[],t.costingCatIds=[],id>0?t.action="Edit":t.action="Create",o.get().then(function(e){t.categories=e.data,n.get(id).then(function(e){t.costing=e.data;for(var o=0;o<=t.categories.length;o++)for(var n=0;n<=t.costing.length;n++)t.costing[n].Category.Id==t.categories[o].Id&&t.categories.splice(o,1)},handleError)},handleError),t.save=a}),app.factory("CostingFactory",function(t,e){"use strict";function o(o){var n=o?o:"";return t.get(e+"/Api/Costing/"+n)}function n(o){return t.post(e+"/Api/Costing",o)}return{get:o,post:n}}),app.controller("LocationController",function(t,e,o){t.dataList={},e.get(o+"/Api/Location").success(function(e){t.dataList=e})}),app.controller("LocationManageController",function(t,e,o){function n(){o.post(t.location).then(function(e){t.location=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError)}t.location={},id>0?t.action="Edit":t.action="Create",o.get(id).then(function(e){t.location=e.data},handleError),t.save=n}),app.controller("PermissionController",function(t,e,o){t.dataList={},e.get(o+"/Api/Permission").success(function(e){t.dataList=e})}),app.controller("PermissionManageController",function(t,e,o){function n(){o.post(t.permission).then(function(e){t.permission=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError)}t.permission={},id>0?t.action="Edit":t.action="Create",o.get(id).then(function(e){t.permission=e.data},handleError),t.save=n}),app.factory("PermissionFactory",function(t,e){"use strict";function o(o){return t.get(e+"Api/Permission/"+o)}function n(o){return t.post(e+"Api/Permission",o)}return{get:o,post:n}}),app.controller("RoleController",function(t,e,o){t.dataList={},e.get(o+"/Api/Role").success(function(e){t.dataList=e})}),app.controller("RoleManageController",function(t,e,o,n){function a(){return $("form").validator("validate"),l()?void n.post("Role",t.model).then(function(e){e.data.Error?toastr.warning(e.data.ErrorMessage):(t.model=e.data,_.each(t.rolePermissions,function(e){e.Role.Id=t.model.Id}),n.post("RolePermission?roleId="+t.model.Id,t.rolePermissions).then(function(e){t.rolePermissions=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError))},handleError):!1}function r(){var e=!1;for(i=0;i<t.rolePermissions.length;i++){var o=t.rolePermissions[i];o.Permission.Id==t.selectedPermission&&(e=!0)}if(e)return void toastr.warning("This item is already in the list!");var n=_.findWhere(t.permissions,{Id:t.selectedPermission});if(n){var a={Id:0,Role:t.model,Permission:n};t.rolePermissions.push(a)}}function s(t,e){t.splice(e,1)}function l(){var t=!0,e="p.help-block.with-errors",o=$("form").find(e);return $.each(o,function(e,o){""!=$(o).html()&&(t=!1)}),t}t.action="Create",t.selectedPermission=0,t.id=null!=o.id?o.id:0,t.blankRolePermission={Id:0,Role:{},Permission:{}},t.id>0&&(t.action="Edit"),n.get("Permission").then(function(e){t.permissions=e.data},handleError),n.get("Role",t.id).then(function(e){t.model=e.data,null!=t.id&&n.get("PermissionsOfRole",t.id).then(function(e){t.rolePermissions=e.data},handleError)},handleError),t.save=a,t.addPermission=r,t.removePermission=s}),app.controller("ServiceController",function(t,e,o){t.dataList={},e.get(o+"/Api/Service").success(function(e){t.dataList=e})}),app.controller("ServiceManageController",function(t,e,o){function n(){o.post(t.service).then(function(e){t.service=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError)}t.service={},id>0?t.action="Edit":t.action="Create",o.get(id).then(function(e){t.service=e.data},handleError),t.save=n}),app.factory("ServiceFactory",function(t,e){"use strict";function o(o){return t.get(e+"Api/Service/"+o)}function n(o){return t.post(e+"Api/Service",o)}return{get:o,post:n}}),app.controller("StaffingController",function(t,e,o){t.dataList={},e.get(o+"/Api/Staffing").success(function(e){t.dataList=e})}),app.controller("StaffingManageController",function(t,e,o){function n(){o.post(t.staffing).then(function(e){t.staffing=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show")},handleError)}t.staffing={},id>0?t.action="Edit":t.action="Create",o.get(id).then(function(e){t.staffing=e.data},handleError),t.save=n}),app.factory("StaffingFactory",function(t,e){"use strict";function o(o){return t.get(e+"Api/Staffing/"+o)}function n(o){return t.post(e+"Api/Staffing",o)}return{get:o,post:n}}),app.controller("UserController",function(t,e,o){t.dataList={},o.get("User","").then(function(e){t.dataList=e.data},handleError)}),app.controller("UserManageController",function(t,e,o,n){function a(){return $("form").validator("validate"),s()?void n.post("User",t.model).then(function(e){e.data.Error?toastr.warning(e.data.ErrorMessage):(t.model=e.data,$("#modal-success").modal({backdrop:"static"}),$("#modal-success").modal("show"))},handleError):!1}function r(){var e=_.findWhere(t.model.Roles,{Id:t.selectedRole});if(e)return void toastr.warning("This item is already in the list!");var o=_.findWhere(t.roles,{Id:t.selectedRole});o&&t.model.Roles.push(o)}function i(t,e){t.splice(e,1)}function s(){var t=!0,e="p.help-block.with-errors",o=$("form").find(e);return $.each(o,function(e,o){""!=$(o).html()&&(t=!1)}),t}t.action="Create",t.selectedRole=0,t.id=null!=o.id?o.id:0,t.id>0&&(t.action="Edit"),n.get("Role").then(function(e){t.roles=e.data},handleError),n.get("User",t.id).then(function(e){t.model=e.data},handleError),t.save=a,t.addRole=r,t.removeRole=i});